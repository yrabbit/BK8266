# БК-0010-01
Эмулятор БК-0010-01 на ESP8266<br/>
Сделан на основе эмулятора Радио-86РК на ESP8266 https://github.com/klad-me/RK8266

# Железо
<ul>
    <li>ESP8266 (с флэшкой), например ESP-01: эмулирует процессор и переферию БК, генерирует видеосигнал стандарта PAL, 
    обрабатывает PS/2 клавиатуру.</li>
    <li>74HC00 (4 элемента 2И-НЕ): используется для генерации видео и синхроимульсов (там простая логика, описана в схеме).</li>
</ul>
В каталоге pcb/ESP-01-LUT есть проект для изготовления платы ЛУТом.<br/>
<img src="photo/ESP-01-LUT/top.jpg" />

# Исходники
Во всех исходниках кодировка КОИ8-Р.<br/>
Проект в стадии разработки.<br/>

# Состав прошивки
Прошивка состоит из 4 частей:
<ul>
    <li>soft/boot-2apps - загрузчик, который переключает между эмулятором и WiFi-прилоежнием.</li>
    <li>soft/EmuAPP - сам эмулятор, работает без SDK полностью из IRAM.</li>
    <li>soft/WiFiAPP - WiFi-приложение для обмена файлами с компьютером.</li>
    <li>soft/WiFiAPP/httpfs - файловая система для HTTP-сервера.</li>
</ul>

# Готовые сборки
Готовые сборки лежат в каталоге builds. Каждый файл имеет имя, соответствующее адресу для прошивки в флэш.<br/>
При прошивке не забывайте правильно указывать размер флэша.<br/>
Пока что все сборки под плату ESP-01-LUT.

# Эмулятор К1801ВМ1
Эмулятор собственный.<br/>
Кое чего подсмотрено из эмулятора Юрия Калмыкова http://gid.pdp-11.ru<br/>
Пока не реализовано:
<ul>
<li>Прерывание по вектору 14 после выполнения каждой команды при установленном в PSW бите T (трассировка).</li>
</ul>

# Переферия
<ul>
<li>Эмуляция графики только в Ч/Б режиме.</li>
<li>PS/2 клавиатура с автоматической перекодировкой русских букв и спец.символов</li>
<li>Реализован перехват обращения к функции чтения / записи на магнитную ленту. Загрузка / запись соответственно происходит из / во flash.</li>
<li>Звук от пищалки и моно Covox на порту 177714 выводится на GPIO14 в виде сигма-дельта модуляции (типа ШИМ). Так что на выходе нужно сделать фильтр (RC).</li>
<li>Реализована эмуляция таймера (регистры 177706, 177710, 177712).</li>
</ul>

# Раскладка клавиатуры
Соответствие клавишам БК-0010-01:
<ul>
<li>любой Alt - АР2</li>
<li>любой Shift - Нижний регистр</li>
<li>любой Ctrl - СУ</li>
<li>Caps Lock - Переключение ЗАГЛ / СТР</li>
<li>левый Win - РУС</li>
<li>правый Win - ЛАТ</li>
<li>Pause - СТОП</li>
<li>F1 - ПОВТ</li>
<li>F2 - КТ</li>
<li>F3 - =|=>|</li>
<li>F4 - |<==</li>
<li>F5 - |==></li>
<li>F6 - ИНД СУ</li>
<li>F7 - БЛОК РЕД</li>
<li>F8 - ШАГ</li>
<li>F9 - СБР</li>
</ul>
Клавиши джойстика:
<ul>
<li>Up - Вверх (разряд 0 порта)</li>
<li>Right - Вправо (разряд 2 порта)</li>
<li>Down - Вниз (разряд 3 порта)</li>
<li>Left - Влево (разряд 4 порта)</li>
<li>Пробел - Кнопка 1 (разряд 1 порта)</li>
<li>A - Кнопка 2 (разряд 5 порта)</li>
<li>S - Кнопка 3 (разряд 6 порта)</li>
<li>D - Кнопка 4 (разряд 7 порта)</li>
<li>F - Кнопка 5 (разряд 8 порта)</li>
</ul>
Клавиши эмулятора:
<ul>
<li>Scroll Lock - Переключение режима Турбо</li>
<li>Print Screen - выход в режим WiFi. Это временное решение. В дальнейшем планируется переходить в режим WiFi из меню по Esc</li>
<li>Esc - выход в меню эмулятора. В данный момент эта функция не реализована.</li>
<li>Num Lock - блокировка клавиш джойстика</li>
</ul>
